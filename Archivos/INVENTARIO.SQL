CREATE DATABASE IF NOT EXISTS INVENTARIO_REPUESTOS;

USE INVENTARIO_REPUESTOS;

CREATE TABLE IF NOT EXISTS USUARIOS(
  ID_USUARIO INT(11) NOT NULL AUTO_INCREMENT,
  NOMBRE VARCHAR(40) NOT NULL,
  APELLIDO VARCHAR(40) NOT NULL,
  CEDULA INT(12) NOT NULL UNIQUE,
  CONTRASENA VARCHAR(200) NOT NULL,
  ROL_ID INT NOT NULL DEFAULT 2,
  PRIMARY KEY(ID_USUARIO),
  FOREIGN KEY(ROL_ID) REFERENCES ROLES(ID_ROL)  
)ENGINE=MyISAM DEFAULT CHARSET=utf8;

INSERT INTO USUARIOS (ID_USUARIO, NOMBRE, APELLIDO, CEDULA, CONTRASENA, ROL_ID) VALUES
(1, 'ADMINISTRADOR', '', 12345678, 'z9oB4Y/NDLo=', 1);


CREATE TABLE IF NOT EXISTS ROLES(
  ID_ROL INT(11) NOT NULL AUTO_INCREMENT,
  DESCRIPCION VARCHAR(20) NOT NULL,
  PRIMARY KEY(ID_ROL)
)ENGINE=MyISAM DEFAULT CHARSET=utf8;

ALTER TABLE USUARIOS ADD FOREIGN KEY(ROL_ID) REFERENCES ROLES(ID_ROL);  

INSERT INTO ROLES (ID_ROL, DESCRIPCION) VALUES
(1, 'ADMIN'),
(2, 'BASICO');

CREATE TABLE IF NOT EXISTS TIPO_REPUESTOS(
  ID_TIPO INT(11) NOT NULL AUTO_INCREMENT,
  DESCRIPCION VARCHAR(50) NOT NULL,
  PRIMARY KEY(ID_TIPO)
)ENGINE=MyISAM DEFAULT CHARSET=utf8;


INSERT INTO TIPO_REPUESTOS (ID_TIPO, DESCRIPCION) VALUES
(1, 'RESISTENCIA'),
(2, 'DIODO'),
(3, 'TRANSISTOR'),
(4, 'CIRCUITO INTEGRADO'),
(5, 'MICROCONTROLADOR'),
(6, 'TARJETA ELECTRONICA'),
(7, 'RELES'),
(8, 'CAPACITORES'),
(9, 'INDUCTORES'),
(10, 'INSTRUMENTOS MEDICION'),
(11, 'HERRAMIENTAS'),
(12, 'MISCELANEOS');

CREATE TABLE IF NOT EXISTS REPUESTOS(
  ID_REPUESTO INT(11) NOT NULL AUTO_INCREMENT,
  NOMBRE VARCHAR(50) NOT NULL,
  DESCRIPCION VARCHAR(50) NOT NULL,
  IMAGEN VARCHAR(100) NOT NULL,
  MARCA_ID INT NOT NULL,
  USUARIO_ID INT NOT NULL,
  TIPO_ID INT NOT NULL,
  PRIMARY KEY(ID_REPUESTO),
  FOREIGN KEY(MARCA_ID) REFERENCES MARCAS(ID_MARCA),
  FOREIGN KEY(USUARIO_ID) REFERENCES USUARIOS(ID_USUARIO),
  FOREIGN KEY(TIPO_ID) REFERENCES TIPO_REPUESTOS(ID_TIPO) 
)ENGINE=MyISAM DEFAULT CHARSET=utf8;

ALTER TABLE REPUESTOS ADD FOREIGN KEY(MARCA_ID) REFERENCES MARCAS(ID_MARCA);
ALTER TABLE REPUESTOS ADD FOREIGN KEY(USUARIO_ID) REFERENCES USUARIOS(ID_USUARIO);
ALTER TABLE REPUESTOS ADD FOREIGN KEY(TIPO_ID) REFERENCES TIPO_REPUESTOS(ID_TIPO);

CREATE TABLE IF NOT EXISTS MARCAS(
  ID_MARCA INT(11) NOT NULL AUTO_INCREMENT,
  DESCRIPCION VARCHAR(50) NOT NULL UNIQUE,
  PRIMARY KEY(ID_MARCA)
)ENGINE=MyISAM DEFAULT CHARSET=utf8;

INSERT INTO MARCAS (ID_MARCA, DESCRIPCION) VALUES
(1, 'TOSHIBA'),
(2, 'MOTOROLA');

CREATE TABLE IF NOT EXISTS STOCK_REPUESTOS(
  ID_STOCK INT(11) NOT NULL AUTO_INCREMENT,
  CANTIDAD INT(11) NOT NULL DEFAULT 0,
  FECHA_INGRESO DATE,
  FECHA_SALIDA DATE,
  UBICACION VARCHAR(30) NOT NULL,
  REPUESTO_ID INT NOT NULL,  
  PRIMARY KEY(ID_STOCK),
  FOREIGN KEY(REPUESTO_ID) REFERENCES REPUESTOS(ID_REPUESTO) 
)ENGINE=MyISAM DEFAULT CHARSET=utf8;

ALTER TABLE STOCK_REPUESTOS ADD FOREIGN KEY(REPUESTO_ID) REFERENCES REPUESTOS(ID_REPUESTO);
